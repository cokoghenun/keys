- name: Restore SSH keys
  hosts: localhost
  vars:
    dir: "~/.ssh"
    public_key: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      31303434366436383537343662653162336666393164653130383233326539393237363632646433
      6634326464626664376235623838343833323331356132610a323035303838386464373331326634
      38383834663031366330376232306336376131656261366164313962303636633634363535616630
      3861356232633138340a363338613563646465323235656332353166633331303165353665313665
      61383862636362373366613633623934613130643230383763366233356231346134303938653166
      33313039373130363530393963336166623363303366336230326665303265336133353639356235
      63373034366664303664393965396163636131316465396130373532303266633332373639336664
      39393162613432633633366265373439363163373263613836666266316530363235616461623231
      6465

    private_key: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      61613333373038623131393136333531306262626131343932653966313931616431643133623165
      3235663138386166636436333864623032306166383831370a386465396338366635656363376461
      32363232373835646166316138383034363032646230393034633861353439663164303832306533
      3234333930373732360a343334373634653839633935323939623931386636383765346362326639
      61363563353530623234656336326363326338646637343534643764383866633531363265373734
      32326636643335363733323133366536363930626438393162633762653465363237343634666162
      63316362653130363339333937306366313561356430666262306330376366363339323539326163
      62316339353966363631366562376631633164363339323964383030626666386561363834373735
      30363666666436613661313439626436623361353930353865393232306539663736656236616662
      33333937323733366533303432353764643330663766336365343233653433373833396235323631
      34343136636338643837313230323664646562386334663336656636613665353932336563383963
      61653833656338643564323338343661303761643835633561656239303462303933646538346535
      30363864343262363638393632323162386464346433656665666339306138323135656565303438
      39643339666562666536646238386637656433326561353830383462326362653063666565336530
      30623066303665373833303662653061343334363337346635666239323363663263306134343933
      39353831396262346535613538353233616338336163386631326266643465636365396139646365
      31343464333366656134376637323865336530326632346565303263323937373735313537653562
      32306561356164353561386435323931626264346330326263623665383065343034633264373933
      38396531613331333865616466303563383763383061623539343761383530333033626330663261
      61373264643532316534383861366162303430663066623333343564376437616538323632636662
      66313564636463616130636534643235383433643763653239303933376663306666626630653937
      34356233623937646538393134326331363862323539323361303532643632333966316433636463
      61653134633266366634386435346232333763646132313765653266383438373431353665363533
      64326636643731633339

  tasks:
    - name: Create directory
      ansible.builtin.file:
        path: "{{dir}}"
        state: directory

    - name: Create public key
      ansible.builtin.copy:
        dest: "{{dir}}/id_ed25519.pub"
        content: "{{public_key}}"

    - name: Create private key
      ansible.builtin.copy:
        dest: "{{dir}}/id_ed25519"
        content: "{{private_key}}"

    - name: Start agent
      ansible.builtin.shell: eval "$(ssh-agent)"

    - name: Add keys to agent
      ansible.builtin.command: ssh-add ~/.ssh/id_ed25519
